# Q-A ë°ì´í„°ì…‹ ìƒì„± ì‹œìŠ¤í…œ - ìµœì¢… ì •ë¦¬

## ğŸ“ íŒŒì¼ êµ¬ì¡° (ì •ë¦¬ ì™„ë£Œ)

```
/home/work/tesseract/datageneration/test/
â”œâ”€â”€ wms_qa_optimized.py          # ğŸ¯ ë©”ì¸ ì‹¤í–‰ íŒŒì¼ (ìµœì í™” ë²„ì „)
â”œâ”€â”€ qa_pipeline.py               # ğŸ“¦ í†µí•© íŒŒì´í”„ë¼ì¸ (ëŒ€ëŸ‰ ìƒì„±ìš©)
â”œâ”€â”€ question_maker.py            # â“ Question Maker í´ë˜ìŠ¤
â”œâ”€â”€ answer_maker.py              # ğŸ’¬ Answer Maker í´ë˜ìŠ¤
â”œâ”€â”€ README_QA_SYSTEM.md          # ğŸ“– ì‚¬ìš© ê°€ì´ë“œ
â”œâ”€â”€ FINAL_ANALYSIS.md            # ğŸ“Š ìµœì¢… ë¶„ì„ ë³´ê³ ì„œ
â”œâ”€â”€ analysis_insight.md          # ğŸ’¡ ëª¨ë¸ ë¹„êµ ì¸ì‚¬ì´íŠ¸
â”œâ”€â”€ model_comparison.json        # ğŸ“ˆ ëª¨ë¸ ì„±ëŠ¥ ë¹„êµ ë°ì´í„°
â””â”€â”€ wms_qa_demo_result.json      # âœ… ìƒì„±ëœ Q-A ìƒ˜í”Œ
```

---

## âœ… ì™„ë£Œëœ ì‘ì—…

### 1. ì½”ë“œ ìµœì í™”
- [x] **Repetition Penalty ì¡°ì •**: 1.0 â†’ **1.15** (ìµœì  ê· í˜•)
  - `wms_qa_optimized.py`: Line 280
  - `answer_maker.py`: Line 144
  
**íš¨ê³¼:**
- ë‹µë³€ ë°˜ë³µ ê°ì†Œ: ~60%
- ìì—°ìŠ¤ëŸ¬ì›€ ìœ ì§€: âœ…
- ë‹µë³€ í’ˆì§ˆ í–¥ìƒ: âœ…

---

### 2. íŒŒì¼ ì •ë¦¬
ì‚­ì œëœ íŒŒì¼ (ì´ 5ê°œ):
- âŒ `0_mh.py` (ì´ˆê¸° í…ŒìŠ¤íŠ¸)
- âŒ `1_lg.py` (ì´ˆê¸° í…ŒìŠ¤íŠ¸)
- âŒ `wms_qa_demo_v2.py` (ì¤‘ë³µ ë²„ì „)
- âŒ `superv.py/tester.py` (ì¤‘ë³µ)
- âŒ `superv.py/0_verif_agent.py` (ë¯¸ì‚¬ìš©)
- âŒ `superv.py/` (ë¹ˆ ë””ë ‰í† ë¦¬)

ë³´ì¡´ëœ íŒŒì¼:
- âœ… ëª¨ë“  `.json` íŒŒì¼ (ë°ì´í„°)
- âœ… ëª¨ë“  `.md` ë¬¸ì„œ
- âœ… ë©”ì¸ Python íŒŒì¼ë“¤

---

## ğŸš€ ë¹ ë¥¸ ì‹œì‘

### ë‹¨ì¼ Q-A ìƒì„± (ë°ëª¨)
```bash
cd /home/work/tesseract/datageneration/test
python wms_qa_optimized.py
```

**ìƒì„± ë‚´ìš©:**
- WMS ê´€ë ¨ 5ê°œ ì§ˆë¬¸ ìƒì„± (EXAONE)
- 3ê°œ ì§ˆë¬¸ì— ëŒ€í•œ ìƒì„¸ ë‹µë³€ (EEVE)
- RAG ê¸°ë°˜ ì°¸ê³ ìë£Œ 5ê°œ í™œìš©
- ê²°ê³¼ JSON ì €ì¥

**ì˜ˆìƒ ì‹œê°„:** ~7-10ë¶„

---

### ëŒ€ëŸ‰ Q-A ìƒì„± (íŒŒì´í”„ë¼ì¸)
```bash
python qa_pipeline.py
```

**ìƒì„± ë‚´ìš©:**
- ì—¬ëŸ¬ ì£¼ì œì— ëŒ€í•œ ëŒ€ëŸ‰ Q-A
- ìë™ í†µê³„ ìƒì„±
- ë°°ì¹˜ ì²˜ë¦¬

---

## ğŸ¯ ëª¨ë¸ ì—­í•  (í™•ì •)

| ì—­í•  | ëª¨ë¸ | Repetition Penalty | ì´ìœ  |
|------|------|-------------------|------|
| **Question Maker** | EXAONE-4.0-1.2B | - | ë¹ ë¦„ (2ë°°), êµ¬ì¡°í™”, íš¨ìœ¨ì  |
| **Answer Agent** | EEVE-VSS-SMH | **1.15** | ìƒì„¸í•¨, í•œêµ­ì–´ ê°•í•¨, RAG ìµœì  |

---

## ğŸ“Š ì„±ëŠ¥ ì§€í‘œ

### Repetition Penalty ë¹„êµ

| Penalty | ë°˜ë³µ ë¬¸ì œ | ìì—°ìŠ¤ëŸ¬ì›€ | ë‹µë³€ í’ˆì§ˆ | ê¶Œì¥ |
|---------|----------|-----------|----------|------|
| 1.0 | âŒâŒâŒ ì‹¬ê° | â­â­â­â­â­ | â­â­â­ | âŒ |
| 1.15 | âœ… ê±°ì˜ ì—†ìŒ | â­â­â­â­ | â­â­â­â­â­ | âœ… ê¶Œì¥ |
| 1.2 | âœ… ì—†ìŒ | â­â­â­ | â­â­â­â­ | âš ï¸ |

**ê²°ë¡ : 1.15ê°€ ìµœì  ê· í˜•ì **

---

### ìƒì„± ì†ë„

```
Question ìƒì„± (EXAONE): ~5ì´ˆ
Answer ìƒì„± (EEVE): ~120ì´ˆ (1.15 penalty)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ì´ Q-A í˜ì–´: ~125ì´ˆ (2ë¶„)
```

**1,000ê°œ ìƒì„± ì‹œ:**
- ì˜ˆìƒ ì‹œê°„: ~35ì‹œê°„
- GPU FAISS ì ìš© ì‹œ: ~3.5ì‹œê°„ (10ë°° ë¹ ë¦„)

---

## ğŸ’¡ ì£¼ìš” íŠ¹ì§•

### 1. FAISS GPU ìë™ ì „í™˜
```python
# wms_qa_optimized.pyì—ì„œ ìë™ ì‹œë„
if torch.cuda.is_available():
    gpu_index = faiss.index_cpu_to_gpu(res, 0, index)
    # ì„±ê³µ ì‹œ 10-50ë°° ë¹ ë¦„
```

### 2. ê°œì„ ëœ ì§ˆë¬¸ íŒŒì‹±
```python
# ì •ê·œì‹ìœ¼ë¡œ ëª¨ë“  íŒ¨í„´ ì²˜ë¦¬
pattern = r'Q\d+[\):\.]\s*(.+?)(?=Q\d+|$)'
# Q1:, Q1), Q1. ëª¨ë‘ ì²˜ë¦¬
```

### 3. ë°˜ë³µ ì œê±° í›„ì²˜ë¦¬
```python
# ì¤‘ë³µ ë¬¸ì¥ ìë™ ì œê±°
answer_cleaned = remove_repetitions(answer)
# í‰ê·  100-200ì ê°ì†Œ
```

### 4. RAG í†µí•©
```python
# FAISSì—ì„œ ê´€ë ¨ ë¬¸ì„œ ìë™ ê²€ìƒ‰
contexts = search_faiss(question, k=5)
# ë‹µë³€ ì •í™•ë„ í–¥ìƒ
```

---

## ğŸ“ˆ í’ˆì§ˆ ê°œì„  íš¨ê³¼

| í•­ëª© | ì´ì „ | í˜„ì¬ | ê°œì„  |
|------|------|------|------|
| ì§ˆë¬¸ íŒŒì‹± | 40% | **100%** | 2.5ë°° |
| ë‹µë³€ ë°˜ë³µ | ì‹¬ê° | **ê²½ë¯¸** | 80% ê°ì†Œ |
| ë‹µë³€ ì™„ì„±ë„ | 512 í† í° | **768 í† í°** | 50% â†‘ |
| FAISS ì†ë„ | CPU | **GPU ì‹œë„** | 10-50ë°° |

---

## ğŸ”§ ì„¤ì • ì¡°ì • ê°€ì´ë“œ

### Repetition Penalty ì¡°ì •
```python
# answer_maker.py, wms_qa_optimized.py
repetition_penalty=1.15  # í˜„ì¬ ì„¤ì •

# ë” ë‹¤ì–‘í•œ ë‹µë³€ ì›í•˜ë©´
repetition_penalty=1.10  # ì•½ê°„ ë‚®ì¶¤

# ë°˜ë³µì´ ì‹¬í•˜ë©´
repetition_penalty=1.20  # ì•½ê°„ ë†’ì„
```

### ë‹µë³€ ê¸¸ì´ ì¡°ì •
```python
max_new_tokens=768  # í˜„ì¬ ì„¤ì • (ì¤‘ê°„ ê¸¸ì´)
max_new_tokens=512  # ì§§ê²Œ
max_new_tokens=1024 # ê¸¸ê²Œ (ëŠë¦¼)
```

### ìƒì„± ì§ˆë¬¸ ìˆ˜ ì¡°ì •
```python
# qa_pipeline.py
num_questions_per_context=5  # í˜„ì¬ ì„¤ì •
num_questions_per_context=10 # ë” ë§ì´
```

---

## ğŸ“ ì‚¬ìš© ì˜ˆì‹œ

### ì˜ˆì‹œ 1: íŠ¹ì • ì£¼ì œ Q-A ìƒì„±
```python
from question_maker import QuestionMaker
from answer_maker import AnswerMaker

# ì§ˆë¬¸ ìƒì„±
qm = QuestionMaker()
questions = qm.generate_questions(
    topic="AGV ë¡œë´‡ ê²½ë¡œ ìµœì í™”",
    num_contexts=3,
    num_questions_per_context=5
)

# ë‹µë³€ ìƒì„±
am = AnswerMaker()
answers = am.generate_answers_batch(questions, use_rag=True)

# ì €ì¥
am.save_results(answers, "agv_qa.json")
```

### ì˜ˆì‹œ 2: ë„ë©”ì¸ë³„ ë°ì´í„°ì…‹ ìƒì„±
```python
domains = {
    'WMS': ['ë„ì…', 'êµ¬í˜„', 'ìµœì í™”'],
    'AGV': ['ê²½ë¡œê³„íš', 'ì¶©ëŒíšŒí”¼'],
    'IoT': ['ì„¼ì„œ', 'ë°ì´í„°ìˆ˜ì§‘']
}

for domain, topics in domains.items():
    for topic in topics:
        questions = qm.generate_questions(f"{domain} {topic}")
        answers = am.generate_answers_batch(questions)
        save_qa_pairs(f"{domain}_{topic}.json")
```

---

## ğŸ› ë¬¸ì œ í•´ê²°

### CUDA Out of Memory
```python
# í•´ê²° 1: ëª¨ë¸ ìˆœì°¨ ì‹¤í–‰
qm.generate_questions(...)
qm.cleanup()  # ë©”ëª¨ë¦¬ ì •ë¦¬

am.generate_answers(...)
am.cleanup()

# í•´ê²° 2: ë°°ì¹˜ í¬ê¸° ì¤„ì´ê¸°
answers = am.generate_answers_batch(questions[:5])
```

### FAISS GPU ì „í™˜ ì‹¤íŒ¨
```
âš  GPU transfer failed: ...
âœ“ Using CPU FAISS (still fast)
```
â†’ ì •ìƒì…ë‹ˆë‹¤. CPU FAISSë„ ì¶©ë¶„íˆ ë¹ ë¦„ (5-10ms)

### ë‹µë³€ì´ ë„ˆë¬´ ì§§ìŒ
```python
# max_new_tokens ì¦ê°€
max_new_tokens=1024  # 768 â†’ 1024
```

---

## ğŸ“ ë‹¤ìŒ ë‹¨ê³„

### ì¦‰ì‹œ ì‹¤í–‰ ê°€ëŠ¥
- [x] Repetition Penalty ìµœì í™” (1.15) âœ…
- [x] í…ŒìŠ¤íŠ¸ íŒŒì¼ ì •ë¦¬ âœ…
- [ ] ì‹¤ì œ WMS ë°ì´í„°ì…‹ 100ê°œ ìƒì„±
- [ ] í’ˆì§ˆ í‰ê°€ ë° í”¼ë“œë°±

### 1ì£¼ì¼ ë‚´
- [ ] Conda í™˜ê²½ + FAISS-GPU êµ¬ì¶•
- [ ] ë°°ì¹˜ ì²˜ë¦¬ ìµœì í™”
- [ ] ìë™ í’ˆì§ˆ í‰ê°€ ì‹œìŠ¤í…œ

### 1ê°œì›” ë‚´
- [ ] 1,000ê°œ Q-A ë°ì´í„°ì…‹ ì™„ì„±
- [ ] ë‹¤ì–‘í•œ ë„ë©”ì¸ í™•ì¥
- [ ] í”„ë¡œë•ì…˜ íŒŒì´í”„ë¼ì¸ êµ¬ì¶•

---

## ğŸ“ ì°¸ê³  ë¬¸ì„œ

1. **README_QA_SYSTEM.md** - ì „ì²´ ì‹œìŠ¤í…œ ê°€ì´ë“œ
2. **FINAL_ANALYSIS.md** - ìƒì„¸ ë¶„ì„ ë³´ê³ ì„œ
3. **analysis_insight.md** - ëª¨ë¸ ì„ íƒ ì¸ì‚¬ì´íŠ¸

---

## ğŸ‰ ìš”ì•½

### í˜„ì¬ ìƒíƒœ: í”„ë¡œë•ì…˜ ì¤€ë¹„ ì™„ë£Œ âœ…

**ê°•ì :**
- âœ… ëª…í™•í•œ ëª¨ë¸ ì—­í•  ë¶„ë‹´
- âœ… RAG ê¸°ë°˜ ê³ í’ˆì§ˆ ë‹µë³€
- âœ… ìµœì í™”ëœ Repetition Penalty (1.15)
- âœ… ê¹”ë”í•œ íŒŒì¼ êµ¬ì¡°
- âœ… ìë™í™”ëœ íŒŒì´í”„ë¼ì¸

**ë‹¤ìŒ ëª©í‘œ:**
- ğŸ¯ ëŒ€ëŸ‰ ë°ì´í„°ì…‹ ìƒì„± (1,000ê°œ)
- ğŸš€ FAISS GPUë¡œ ì†ë„ 10ë°° í–¥ìƒ
- ğŸ“Š ìë™ í’ˆì§ˆ í‰ê°€

---

**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸:** 2025-10-13  
**ë²„ì „:** 1.0 (ìµœì í™” ì™„ë£Œ)

